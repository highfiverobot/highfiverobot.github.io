<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV Data Table</title>
    <!-- Tailwind CSS CDN for basic styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray background */
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to top */
            min-height: 100vh;
            padding: 2rem;
        }
        .container {
            background-color: #ffffff;
            padding: 2.5rem;
            border-radius: 1rem; /* Rounded corners */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* Subtle shadow */
            width: 100%;
            max-width: 960px; /* Max width for readability */
            overflow-x: auto; /* Enable horizontal scrolling for wide tables */
        }
        table {
            width: 100%;
            border-collapse: separate; /* Allows border-radius on cells */
            border-spacing: 0;
            border-radius: 0.5rem; /* Rounded corners for the table */
            overflow: hidden; /* Ensures content respects border-radius */
        }
        th, td {
            padding: 1rem 1.5rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb; /* Light gray border */
        }
        th {
            background-color: #4f46e5; /* Indigo 600 */
            color: #ffffff;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-size: 0.875rem; /* sm text */
        }
        tr:last-child td {
            border-bottom: none; /* No border for the last row */
        }
        tbody tr:hover {
            background-color: #eff6ff; /* Light blue on hover */
        }
        .loading-message {
            text-align: center;
            padding: 2rem;
            font-size: 1.125rem; /* lg text */
            color: #6b7280; /* Gray 500 */
        }
        .error-message {
            text-align: center;
            padding: 2rem;
            font-size: 1.125rem; /* lg text */
            color: #ef4444; /* Red 500 */
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">CSV Data Display</h1>
        <div id="table-container" class="loading-message">
            Loading data...
        </div>
    </div>

    <!-- Papa Parse CDN for easy CSV parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script>
        // NEW LOG: Check if PapaParse is defined immediately after its script tag
        console.log('Log 1.6: Type of PapaParse after CDN script (CDN स्क्रिप्टनंतर PapaParse चा प्रकार):', typeof PapaParse);
    </script>

    <script>
        // Function to fetch CSV data and render it as an HTML table
        async function loadCsvData() {
            const tableContainer = document.getElementById('table-container');
            const csvFilePath = 'trade_have.csv'; // Updated CSV file path - removed the leading underscore

            console.log('Log 0: Current URL (सध्याची URL):', window.location.href); 
            console.log('Log 1: Attempting to load CSV data from (CSV डेटा लोड करण्याचा प्रयत्न करत आहे):', csvFilePath); 

            try {
                // IMPORTANT DEBUGGING STEP: Explicitly construct the URL to see what fetch will use
                const resolvedCsvUrl = new URL(csvFilePath, window.location.href).toString();
                console.log('Log 1.5: Resolved CSV URL (रिझॉल्व्ह केलेली CSV URL):', resolvedCsvUrl); 

                // Fetch the CSV file
                const response = await fetch(resolvedCsvUrl); 
                console.log('Log 2: Fetch response received (फेट्च प्रतिसाद प्राप्त झाला):', response); 

                // Check if the fetch was successful
                if (!response.ok) {
                    console.error('Log 3: HTTP error! Status (HTTP एरर! स्थिती):', response.status, 'Status Text (स्थिती मजकूर):', response.statusText); 
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                // Get the text content of the CSV file
                const csvText = await response.text();
                console.log('Log 4: CSV text content fetched (CSV मजकूर सामग्री आणली):', csvText.substring(0, 200) + '...'); 

                // Use Papa Parse to parse the CSV text
                PapaParse.parse(csvText, { // This is line 110 in the current Canvas code
                    header: false, 
                    skipEmptyLines: true, 
                    complete: function(results) {
                        const data = results.data;
                        const errors = results.errors;

                        console.log('Log 5: Papa Parse results (पापा पार्स परिणाम):', results); 
                        console.log('Log 6: Parsed data (पार्स केलेला डेटा):', data); 
                        console.log('Log 7: Parsing errors (पार्सिंग त्रुटी):', errors); 

                        if (errors.length > 0) {
                            console.error("CSV Parsing Errors (CSV पार्सिंग त्रुटी):", errors);
                            tableContainer.innerHTML = `<div class="error-message">Error parsing CSV: ${errors[0].message}</div>`;
                            return;
                        }

                        if (data.length === 0) {
                            tableContainer.innerHTML = `<div class="loading-message">No data found in CSV.</div>`;
                            return;
                        }

                        // Create the table element
                        const table = document.createElement('table');
                        table.classList.add('min-w-full', 'divide-y', 'divide-gray-200', 'shadow-sm', 'rounded-lg');

                        // Create table header (thead)
                        const thead = document.createElement('thead');
                        const headerRow = document.createElement('tr');
                        
                        // Generate generic headers if no header row is present
                        const numColumns = data[0].length;
                        for (let i = 0; i < numColumns; i++) {
                            const th = document.createElement('th');
                            th.textContent = `Column ${i + 1}`; 
                            headerRow.appendChild(th);
                        }
                        thead.appendChild(headerRow);
                        table.appendChild(thead);

                        // Create table body (tbody)
                        const tbody = document.createElement('tbody');
                        tbody.classList.add('bg-white', 'divide-y', 'divide-gray-200');

                        // Loop through the data rows
                        data.forEach(rowData => {
                            const tr = document.createElement('tr');
                            rowData.forEach(cellData => {
                                const td = document.createElement('td');
                                td.textContent = cellData || ''; 
                                tr.appendChild(td);
                            });
                            tbody.appendChild(tr);
                        });
                        table.appendChild(tbody);

                        // Clear loading message and append the table
                        tableContainer.innerHTML = '';
                        tableContainer.appendChild(table);
                        console.log('Log 8: Table rendered successfully (टेबल यशस्वीरित्या रेंडर झाले).'); 
                    }
                });

            } catch (error) {
                console.error('Log 9: Error loading CSV data in catch block (कॅच ब्लॉकमध्ये CSV डेटा लोड करताना त्रुटी):', error); 
                tableContainer.innerHTML = `<div class="error-message">Failed to load CSV data. Please check the file path and network connection.</div>`;
            }
        }

        // Call the function when the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', loadCsvData);
    </script>
</body>
</html>
